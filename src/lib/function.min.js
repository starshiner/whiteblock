var xhrFactory=function(){this.init.apply(this,arguments)};xhrFactory.prototype={init:function(){this.xhr=this.create()},create:function(){var xhr=null;try{if(window.XMLHttpRequest){xhr=new XMLHttpRequest()}else{if(window.ActiveXObject){xhr=new ActiveXObject("Msxml2.Xmlhttp")}}}catch(err){xhr=new ActiveXObject("Microsoft.Xmlhttp")}return xhr},para:function(data){var datastr="";if(data&&Object.prototype.toString.call(data)=="[object Object]"){for(var a in data){datastr+=encodeURIComponent(a)+"="+encodeURIComponent(data[a])+"&"}}return datastr},ajax:function(obj){this.url=obj.url;this.data=obj.data||null;this.async=(typeof async==="undefined")?true:async;this.timeout=obj.timeout||20000;this.type=obj.type||"get";this.dataType=obj.dataType||"json";this.complete=obj.complete||function(){};this.success=obj.success||function(){};this.timeoutFnc=obj.timeoutFnc||function(){};this.error=obj.error||function(){};if(this.dataType=="jsonp"){var datastr=this.para(this.data);var script=document.createElement("script");script.src=this.url+"?"+datastr+"callback="+obj.name+".success";document.body.insertBefore(script,document.body.firstChild)}else{if(this.type=="post"){this.post()}else{this.get()}}},post:function(){try{this.readystate(this.complete,this.success,this.timeoutFnc,this.timeout);var newurl=this.url;var datastr=this.para(this.data);this.xhr.open("post",newurl,this.async);this.xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded");this.xhr.send(!datastr?null:datastr)}catch(e){this.error(e)}},get:function(){try{this.readystate(this.complete,this.success,this.timeoutFnc,this.timeout);var newurl=this.url;var datastr=this.para(this.data);newurl=this.url+"?"+datastr;this.xhr.open("get",newurl,this.async);this.xhr.send(null)}catch(e){this.error(e)}},readystate:function(complete,success,timeoutFnc,timeout){this.xhr.onreadystatechange=function(){if(this.readyState==2){complete()}if(this.readyState==4&&this.status==200){success(eval("("+this.responseText+")"));clearTimeout(timer)}};var timer=setTimeout(function(){timeoutFnc()},timeout)}};